<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel Admin Avan√ßado - Quanton3D</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen">
  <div id="app"></div>

  <script>
    const ADMIN_PASSWORD = 'quanton3d2024';
    const API_URL = 'https://quanton3d-bot-v2.onrender.com';
    
    let isAuthenticated = false;
    let suggestions = [];
    let currentView = 'suggestions'; // suggestions, knowledge, add

    function renderLogin() {
      document.getElementById('app').innerHTML = `
        <div class="min-h-screen flex items-center justify-center p-4">
          <div class="bg-white rounded-lg shadow-2xl p-8 max-w-md w-full">
            <div class="flex items-center justify-center mb-6">
              <div class="h-16 w-16 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center">
                <svg class="h-8 w-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
              </div>
            </div>
            <h2 class="text-2xl font-bold mb-6 text-center bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
              Painel Administrativo Avan√ßado
            </h2>
            <p class="text-center text-gray-600 mb-6">
              Gerenciamento Completo de Conhecimento
            </p>
            <div class="space-y-4">
              <input
                type="password"
                id="password"
                placeholder="Senha de administrador"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <button
                onclick="handleLogin()"
                class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-2 rounded-lg font-semibold hover:opacity-90 transition"
              >
                Entrar
              </button>
            </div>
          </div>
        </div>
      `;

      document.getElementById('password').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleLogin();
      });
    }

    function handleLogin() {
      const password = document.getElementById('password').value;
      if (password === ADMIN_PASSWORD) {
        isAuthenticated = true;
        loadSuggestions();
      } else {
        alert('Senha incorreta!');
      }
    }

    async function loadSuggestions() {
      renderLoading();
      try {
        const response = await fetch(`${API_URL}/suggestions?auth=quanton3d_admin_secret`);
        const data = await response.json();
        suggestions = data.suggestions || [];
        renderDashboard();
      } catch (error) {
        console.error('Erro ao carregar sugest√µes:', error);
        renderError(error.message);
      }
    }

    function renderLoading() {
      document.getElementById('app').innerHTML = `
        <div class="min-h-screen p-4">
          <div class="container mx-auto max-w-7xl py-8">
            <div class="flex items-center justify-center">
              <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
            </div>
            <p class="text-center mt-4 text-gray-600">Carregando...</p>
          </div>
        </div>
      `;
    }

    function renderError(message) {
      document.getElementById('app').innerHTML = `
        <div class="min-h-screen p-4">
          <div class="container mx-auto max-w-7xl py-8">
            <div class="bg-red-50 border border-red-200 rounded-lg p-6 text-center">
              <p class="text-red-600 font-semibold">Erro ao carregar</p>
              <p class="text-red-500 text-sm mt-2">${message}</p>
              <button onclick="loadSuggestions()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                Tentar Novamente
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function renderDashboard() {
      const content = currentView === 'suggestions' ? renderSuggestionsView() :
                     currentView === 'knowledge' ? renderKnowledgeView() :
                     renderAddKnowledgeView();

      document.getElementById('app').innerHTML = `
        <div class="min-h-screen p-4">
          <div class="container mx-auto max-w-7xl py-8">
            <!-- Header -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
              <div class="flex items-center justify-between">
                <div>
                  <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                    Painel Admin Avan√ßado
                  </h1>
                  <p class="text-gray-600 mt-1">Gerenciamento Completo de Conhecimento</p>
                </div>
                <button 
                  onclick="logout()"
                  class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition"
                >
                  Sair
                </button>
              </div>
            </div>

            <!-- Navigation -->
            <div class="bg-white rounded-lg shadow-lg p-4 mb-6">
              <div class="flex gap-2">
                <button 
                  onclick="switchView('suggestions')"
                  class="flex-1 py-2 px-4 rounded-lg font-semibold transition ${currentView === 'suggestions' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}"
                >
                  üìù Sugest√µes (${suggestions.length})
                </button>
                <button 
                  onclick="switchView('knowledge')"
                  class="flex-1 py-2 px-4 rounded-lg font-semibold transition ${currentView === 'knowledge' ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}"
                >
                  üìö Base de Conhecimento
                </button>
                <button 
                  onclick="switchView('add')"
                  class="flex-1 py-2 px-4 rounded-lg font-semibold transition ${currentView === 'add' ? 'bg-green-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}"
                >
                  ‚ûï Adicionar Conhecimento
                </button>
              </div>
            </div>

            <!-- Content -->
            ${content}
          </div>
        </div>
      `;
    }

    function renderSuggestionsView() {
      if (suggestions.length === 0) {
        return `
          <div class="bg-white rounded-lg shadow-lg p-12 text-center">
            <svg class="h-16 w-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <p class="text-gray-600">Nenhuma sugest√£o pendente no momento</p>
          </div>
        `;
      }

      return suggestions.map((suggestion, index) => `
        <div class="bg-white rounded-lg shadow-lg p-6 mb-4">
          <div class="flex items-start justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="h-10 w-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold">
                ${suggestion.userName?.charAt(0) || 'U'}
              </div>
              <div>
                <p class="font-semibold">${suggestion.userName || 'Usu√°rio'}</p>
                <div class="flex items-center gap-4 text-sm text-gray-600">
                  <span>üì± ${suggestion.userPhone || 'N/A'}</span>
                  <span>üìÖ ${new Date(suggestion.timestamp).toLocaleString('pt-BR')}</span>
                </div>
              </div>
            </div>
            <span class="px-3 py-1 rounded-full text-xs font-semibold ${
              suggestion.status === 'pending' 
                ? 'bg-yellow-100 text-yellow-800'
                : suggestion.status === 'approved'
                ? 'bg-green-100 text-green-800'
                : 'bg-red-100 text-red-800'
            }">
              ${suggestion.status === 'pending' ? 'Pendente' : suggestion.status === 'approved' ? 'Aprovado' : 'Rejeitado'}
            </span>
          </div>

          <div class="bg-gray-50 rounded-lg p-4 mb-4">
            <p class="text-sm whitespace-pre-wrap">${suggestion.suggestion}</p>
          </div>

          ${suggestion.status === 'pending' ? `
            <div class="flex gap-2">
              <button 
                onclick="approveSuggestion(${index})"
                class="flex-1 bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-700 transition"
              >
                ‚úì Aprovar e Adicionar
              </button>
              <button 
                onclick="rejectSuggestion(${index})"
                class="flex-1 border border-gray-300 py-2 rounded-lg font-semibold hover:bg-gray-50 transition"
              >
                ‚úó Rejeitar
              </button>
            </div>
          ` : ''}
        </div>
      `).join('');
    }

    function renderKnowledgeView() {
      return `
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-2xl font-bold mb-4">Base de Conhecimento Atual</h2>
          <p class="text-gray-600 mb-6">
            Visualize e edite o conhecimento do bot. As altera√ß√µes s√£o salvas automaticamente.
          </p>
          
          <div class="space-y-4">
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
              <h3 class="font-bold text-lg mb-2">üì¶ Resinas Quanton3D (13)</h3>
              <p class="text-sm text-gray-700 mb-3">
                Pyroblast+, Iron, Spin+, Poseidon, Spark, FlexForm, Alchemist, LowSmell, VulcanCast, 
                Athom Dental, Athom Gengiva, Athom Castable, Athom Alinhadores
              </p>
              <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                Editar Resinas
              </button>
            </div>

            <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
              <h3 class="font-bold text-lg mb-2">üîß Conhecimento T√©cnico</h3>
              <p class="text-sm text-gray-700 mb-3">
                Fatiadores (Chitubox, Lychee), Par√¢metros de impress√£o, Altura de camada, Suportes, Calibra√ß√£o
              </p>
              <button class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                Editar T√©cnico
              </button>
            </div>

            <div class="bg-green-50 border border-green-200 rounded-lg p-6">
              <h3 class="font-bold text-lg mb-2">üõ°Ô∏è Seguran√ßa e EPIs</h3>
              <p class="text-sm text-gray-700 mb-3">
                EPIs obrigat√≥rios, Primeiros socorros, Armazenamento, Descarte
              </p>
              <button class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                Editar Seguran√ßa
              </button>
            </div>

            <div class="bg-orange-50 border border-orange-200 rounded-lg p-6">
              <h3 class="font-bold text-lg mb-2">‚ùì Problemas Comuns</h3>
              <p class="text-sm text-gray-700 mb-3">
                Falhas de ader√™ncia, Linhas horizontais, Deforma√ß√µes, Suportes quebrando
              </p>
              <button class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition">
                Editar Problemas
              </button>
            </div>
          </div>

          <div class="mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
            <p class="text-sm text-yellow-800">
              <strong>‚ö†Ô∏è Nota:</strong> Para editar o conhecimento, voc√™ precisa modificar os arquivos no backend 
              (knowledge-base.js, technical-knowledge.js) e fazer deploy. Esta funcionalidade de edi√ß√£o online 
              ser√° implementada em breve.
            </p>
          </div>
        </div>
      `;
    }

    function renderAddKnowledgeView() {
      return `
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-2xl font-bold mb-4">Adicionar Novo Conhecimento</h2>
          <p class="text-gray-600 mb-6">
            Adicione novas informa√ß√µes √† base de conhecimento do bot.
          </p>
          
          <form onsubmit="handleAddKnowledge(event)" class="space-y-4">
            <div>
              <label class="block text-sm font-semibold mb-2">Categoria</label>
              <select id="category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="resina">Nova Resina</option>
                <option value="tecnico">Conhecimento T√©cnico</option>
                <option value="problema">Problema Comum</option>
                <option value="seguranca">Seguran√ßa/EPI</option>
                <option value="outro">Outro</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-semibold mb-2">T√≠tulo</label>
              <input 
                type="text" 
                id="title" 
                placeholder="Ex: Nova Resina XYZ"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                required
              />
            </div>

            <div>
              <label class="block text-sm font-semibold mb-2">Conte√∫do</label>
              <textarea 
                id="content" 
                rows="10"
                placeholder="Descreva detalhadamente o novo conhecimento..."
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                required
              ></textarea>
            </div>

            <div class="flex gap-3">
              <button 
                type="submit"
                class="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:opacity-90 transition"
              >
                üíæ Salvar Conhecimento
              </button>
              <button 
                type="button"
                onclick="switchView('knowledge')"
                class="px-6 border border-gray-300 py-3 rounded-lg font-semibold hover:bg-gray-50 transition"
              >
                Cancelar
              </button>
            </div>
          </form>

          <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
            <p class="text-sm text-blue-800">
              <strong>üí° Dica:</strong> Ap√≥s salvar, o conhecimento ser√° adicionado ao arquivo knowledge-base.js. 
              Voc√™ precisar√° fazer deploy para que o bot comece a usar as novas informa√ß√µes.
            </p>
          </div>
        </div>
      `;
    }

    function switchView(view) {
      currentView = view;
      renderDashboard();
    }

    function logout() {
      isAuthenticated = false;
      currentView = 'suggestions';
      renderLogin();
    }

    function approveSuggestion(index) {
      const suggestion = suggestions[index];
      const confirmed = confirm(`Aprovar sugest√£o de ${suggestion.userName}?\n\n"${suggestion.suggestion.substring(0, 100)}..."\n\nVoc√™ precisar√° adicionar manualmente ao knowledge-base.js`);
      if (confirmed) {
        suggestions[index].status = 'approved';
        renderDashboard();
        alert('Sugest√£o aprovada! Lembre-se de adicionar ao knowledge-base.js no backend.');
      }
    }

    function rejectSuggestion(index) {
      const confirmed = confirm('Rejeitar esta sugest√£o?');
      if (confirmed) {
        suggestions[index].status = 'rejected';
        renderDashboard();
      }
    }

    function handleAddKnowledge(event) {
      event.preventDefault();
      const category = document.getElementById('category').value;
      const title = document.getElementById('title').value;
      const content = document.getElementById('content').value;

      const knowledge = {
        category,
        title,
        content,
        timestamp: new Date().toISOString()
      };

      console.log('Novo conhecimento:', knowledge);
      alert('Conhecimento salvo! Para aplicar, adicione ao arquivo knowledge-base.js:\n\n' + JSON.stringify(knowledge, null, 2));
      
      // Limpar formul√°rio
      document.getElementById('title').value = '';
      document.getElementById('content').value = '';
    }

    // Inicializar
    renderLogin();
  </script>
</body>
</html>
